# S04 - Приоритизация рисков L×I

Этот файл агрегирует риски из `S04_stride_matrix.md`

---

## Шкала L×I (1-5)

**Likelihood (вероятность):**
1 - маловероятно (редкая поверхность, сложная эксплуатация, хорошая детекция)
2 - низкая
3 - средняя
4 - высокая
5 - очень высокая (публичная поверхность, типовая уязвимость, слабая детекция)

**Impact (ущерб):**
1 - низкий (локальный эффект, без PII/денег/доступности)
2 - умеренный
3 - значимый (PII/деньги одного клиента/подсистемы)
4 - высокий (существенный ущерб/простой)
5 - критичный (массовая утечка, компрометация прав, длительный простой)

**Score = L × I** → сортируем по убыванию → отмечаем **Top-5**.

---

## Тай-брейкеры при равенстве Score

* **Blast radius** - масштаб затрагиваемых пользователей/тенантов/данных.
* **Detectability** - насколько быстро обнаружим (логи/алерты/аудит) или это скрытно.
* **Compliance** - приватность/платёжные/регуляторные последствия.
* **Time-to-Mitigate** - насколько быстро/безопасно закрывается.
* **Dependency risk** - зависит от внешних провайдеров/узких мест.

---

## Таблица приоритизации

| Risk ID | Source (DFD/Row)            | Consolidated Description                                                                                                                                                | Threat (S/T/R/I/D/E)    | NFR link (ID)              | L (1–5) | Rationale-L                                                                                                              | I (1–5) | Rationale-I                                                                                                                    | Score (=L×I) | Decision (Top-5?) | ADR candidate                |
|---------|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|----------------------------|---------|--------------------------------------------------------------------------------------------------------------------------|---------|--------------------------------------------------------------------------------------------------------------------------------|--------------|--------------------|------------------------------|
| R-01    | Edge: Logic → Vendor        | Cascading Failure / Service Hang: Внешний API (Vendor X) перестает отвечать или отвечает долго. Потоки сервиса «залипают», вызывая полный отказ системы.                | D (DoS)                 | NFR-008, NFR-009           | 4       | Высокая: внешние сети и API ненадежны; сбои будут происходить гарантированно.                                            | 5       | Критично: исчерпание пула соединений «кладет» весь сервис, включая функционал, не связанный с вендором.                        | 20           | Top-1              | Circuit Breaker & Timeouts   |
| R-02    | Edge: User → API (Files)    | Malicious File Upload: Загрузка исполнимых файлов под видом картинок или HTML с XSS. Обход поверхностных проверок расширений.                                           | T (Tampering)           | NFR-002                    | 3       | Средняя: требует намеренных действий злоумышленника; инструменты широко доступны.                                        | 5       | Критично: RCE ведёт к полной компрометации сервера и данных.                                                                   | 15           | Top-2              | Secure File Validation       |
| R-03    | Edge: Logic → LogSink       | PII Leak in Logs: Случайное логирование чувствительных данных при ошибках или отладке.                                                                                  | I (Info Discl.)         | NFR-005                    | 5       | Очень высокая: разработчики часто забывают убрать отладочный вывод; формат объектов меняется.                            | 3       | Значимо: нарушение 152-ФЗ/GDPR и репутационные риски, несмотря на сохранение работоспособности системы.                        | 15           | Top-3              | PII Masking Strategy         |
| R-04    | Edge: User → API (Public)   | Public API DoS: Исчерпание ресурсов через массированные запросы на загрузку файлов или тяжёлый экспорт.                                                                 | D (DoS)                 | NFR-001, NFR-003, NFR-004  | 4       | Высокая: публичные эндпоинты доступны всему интернету; атака тривиальна.                                                 | 3       | Значимо: деградация производительности для легитимных пользователей и рост затрат на инфраструктуру.                           | 12           | Top-4              | Rate Limiting & Shielding    |
| R-05    | Edge: API → Logic           | IDOR on Export: Подмена ID в запросе `/export` позволяет получить архив данных другого пользователя.                                                                    | E (Elevation)           | need NFR (AuthZ)           | 3       | Средняя: зависит от качества реализации проверок; очень распространённая API-уязвимость (OWASP Top-1).                   | 4       | Высокая: утечка конфиденциальных данных.                                                                                       | 12           | Top-5              | Resource Ownership Policy    |
| R-06    | Edge: Logic → Vendor        | Untraceable Errors: Невозможно связать ошибку вендора с запросом клиента из-за отсутствия сквозного ID.                                                                 | R (Repudiation)         | NFR-007                    | 5       | Очень высокая: без явного требования такие механизмы обычно не внедряются.                                               | 2       | Умеренно: усложняет отладку и увеличивает MTTR, но не нарушает работу бизнеса.                                                 | 10           | –                  | Correlation ID Propagation   |
| R-07    | Edge: Logic → DB            | Slow DB Queries (Export): Долгие запросы при генерации больших отчётов блокируют БД и влияют на OLTP-операции.                                                          | D (DoS)                 | NFR-006                    | 3       | Средняя: проблема проявится по мере роста данных.                                                                        | 3       | Значимо: периодические «тормоза» системы.                                                                                      | 9            | –                  | Read-Replica / Async Jobs    |

---

## Сводка Top-5 (итог блока)

* **Top-1**: R-01 (Score: 20) — Cascading Failure. Риск полной остановки бизнеса из-за сбоя партнера. \
ADR Candidate: Circuit Breaker & Timeouts (использование resilience-библиотеки).
* **Top-2**: R-02 (Score: 15) — Malicious File Upload. Риск полного захвата контроля над сервером (RCE). \
ADR Candidate: Secure File Validation (Magic bytes check, renaming, sandboxing).
* **Top-3**: R-03 (Score: 15) — PII Leak in Logs. Высокая вероятность + юридические риски. \
ADR Candidate: PII Masking Strategy (Middleware или Log-formatter с паттернами).
* **Top-4**: R-04 (Score: 12) — Public API DoS. Уязвимость публичного интерфейса. \
ADR Candidate: Rate Limiting (Token bucket per IP/User на уровне Gateway).
* **Top-5**: R-05 (Score: 12) — IDOR on Export. Риск утечки пользовательских данных. \
ADR Candidate: Resource Ownership Policy (Стандартизация проверок AuthZ в middleware).

---
